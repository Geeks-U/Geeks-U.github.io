import{g as F}from"./request-CpWNVJmJ.js";import{d as b,h as v,j as U,c as r,a as e,k as g,e as m,v as T,F as y,f as k,l as x,t as p,o as c,_ as w,i as B,b as C}from"./index-C4DEVhoW.js";const h="Geeks-U",L=600*1e3,A=new Map,f=(l=1,a=[])=>{const n=`${h}_page_${l}`,t=Date.now(),s=A.get(n);return s&&t-s.timestamp<L?Promise.resolve(a.concat(s.data)):F.get(`users/${h}/repos`,{params:{per_page:100,page:l}}).then(({data:o})=>{A.set(n,{timestamp:t,data:o});const d=a.concat(o);return o.length<100?d:f(l+1,d)})},E=new Map,$=l=>{const a=`${h}_${l}`,n=Date.now(),t=E.get(a);return t&&n-t.timestamp<L?Promise.resolve(t.data):F.get(`repos/${h}/${l}/topics`).then(({data:s})=>(E.set(a,{timestamp:n,data:s.names}),s.names)).catch(()=>[])},M=()=>f().then(l=>{const a=l.map(n=>$(n.name));return Promise.all(a).then(n=>{const t=new Set;return n.forEach(s=>{s.forEach(o=>t.add(o))}),Array.from(t)})}),V=async l=>{const n=(await f()).map(async s=>{const o=await $(s.name);return{...s,topics:o}});return(await Promise.all(n)).filter(s=>l.every(o=>s.topics.includes(o)))},W=async l=>{const n=(await f()).map(async s=>{const o=await $(s.name);return{...s,topics:o}});return(await Promise.all(n)).filter(s=>s.topics.some(o=>l.includes(o)))},D={class:"repo-filters"},S={class:"filter-mode"},I={class:"filter-label"},N={class:"filter-label"},K={class:"topics-grid"},j={key:0,class:"loading-placeholder"},z=["value"],G=b({__name:"RepoFilters",props:{topics:{},isLoading:{type:Boolean}},emits:["filter"],setup(l,{emit:a}){const n=l,t=a,s=v([]),o=v("any"),d=()=>{s.value.length!==0&&t("filter",s.value,o.value)},_=()=>{s.value=[]};return U(()=>n.topics,()=>{s.value=[]}),(R,i)=>(c(),r("div",D,[e("div",S,[e("label",I,[g(e("input",{type:"radio",value:"any","onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u)},null,512),[[T,o.value]]),i[3]||(i[3]=m(" 任意-匹配 (any) "))]),e("label",N,[g(e("input",{type:"radio",value:"all","onUpdate:modelValue":i[1]||(i[1]=u=>o.value=u)},null,512),[[T,o.value]]),i[4]||(i[4]=m(" 全部-匹配 (all) "))])]),e("div",K,[R.isLoading?(c(),r("div",j,i[5]||(i[5]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"正在加载标签...",-1)]))):(c(!0),r(y,{key:1},k(R.topics,u=>(c(),r("label",{key:u,class:"topic-label"},[g(e("input",{type:"checkbox",value:u,"onUpdate:modelValue":i[2]||(i[2]=P=>s.value=P)},null,8,z),[[x,s.value]]),m(" "+p(u),1)]))),128))]),e("div",{class:"button-group"},[e("button",{onClick:_,class:"repo-button repo-button-secondary"}," 清空选择 "),e("button",{onClick:d,class:"repo-button repo-button-primary"}," 筛选仓库 ")])]))}}),H=w(G,[["__scopeId","data-v-e67cd694"]]),O={class:"repo-container"},q={key:0,class:"loading-placeholder"},J={class:"repo-header"},Q=["onClick"],X={class:"repo-description"},Y={class:"repo-stats"},Z={class:"repo-stat"},ss={class:"repo-stat"},es={class:"repo-stat"},ts={class:"repo-footer"},os={class:"repo-language"},ns={class:"repo-topics"},as={key:2,class:"empty-placeholder"},ls=b({__name:"RepoList",props:{repos:{},isLoading:{type:Boolean}},setup(l){const a=n=>{n&&window.open(n,"_blank")};return(n,t)=>(c(),r("div",O,[n.isLoading?(c(),r("div",q,t[0]||(t[0]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"正在加载仓库...",-1)]))):n.repos.length?(c(!0),r(y,{key:1},k(n.repos,s=>(c(),r("div",{key:s.name,class:"repo-card"},[e("header",J,[e("h3",{class:"repo-title",onClick:o=>a(s.html_url),role:"button"},[m(p(s.name)+" ",1),t[1]||(t[1]=e("span",{class:"external-link-icon"},"↗",-1))],8,Q),e("p",X,p(s.description||"无描述"),1)]),e("div",Y,[e("div",Z,[t[2]||(t[2]=e("span",{class:"stat-icon"},"⭐",-1)),e("span",null,p(s.stargazers_count||0),1)]),e("div",ss,[t[3]||(t[3]=e("span",{class:"stat-icon"},"👁️",-1)),e("span",null,p(s.watchers_count||0),1)]),e("div",es,[t[4]||(t[4]=e("span",{class:"stat-icon"},"🍴",-1)),e("span",null,p(s.forks_count||0),1)])]),e("footer",ts,[e("div",os,[t[5]||(t[5]=e("span",{class:"language-dot"},null,-1)),e("span",null,p(s.language||"Unknown"),1)]),e("div",ns,[(c(!0),r(y,null,k(s.topics,o=>(c(),r("span",{key:o,class:"repo-topic"},p(o),1))),128))])])]))),128)):(c(),r("div",as,t[6]||(t[6]=[e("span",null,"请选择标签进行筛选",-1)])))]))}}),is=w(ls,[["__scopeId","data-v-48a845aa"]]),rs={class:"repo-page"},cs={class:"repo-controls"},ps=b({__name:"index",setup(l){const a=v([]),n=v([]),t=v(!1);B(async()=>{try{a.value=await M()}catch(o){console.error("Error fetching topics:",o)}});const s=async(o,d)=>{t.value=!0;try{const _=d==="all"?V:W;n.value=await _(o)}catch(_){console.error("Error fetching repos:",_)}finally{t.value=!1}};return(o,d)=>(c(),r("div",rs,[e("div",cs,[C(H,{topics:a.value,"is-loading":!a.value.length,onFilter:s},null,8,["topics","is-loading"])]),C(is,{repos:n.value,"is-loading":t.value},null,8,["repos","is-loading"])]))}}),_s=w(ps,[["__scopeId","data-v-8dbc98cb"]]);export{_s as default};
